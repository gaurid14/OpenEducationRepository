{% load static %}
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>{{ question.title }} • OER Forum</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>.reply-branch{border-left:3px solid #e9ecef;padding-left:.75rem;margin-left:.25rem;margin-top:.4rem}</style>
</head>
<body class="bg-light">
<div class="container py-4">
  <a class="btn btn-link mb-3 p-0" href="{% url 'forum_home' %}">← All discussions</a>

  <div class="card mb-3">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-start">
        <h4 class="mb-1">{{ question.title }}</h4>
        <form method="post" action="{% url 'forum_question_upvote' question.id %}">
          {% csrf_token %}
          <button class="btn btn-outline-primary btn-sm">▲ {{ question.total_upvotes }}</button>
        </form>
      </div>

      <div class="text-muted mb-2 d-flex align-items-center gap-2">
        <span>by <strong>{{ question.author.username }}</strong> • {{ question.created_at|date:"M d, Y H:i" }}</span>
        {% if user.is_authenticated and user.id != question.author_id %}
          <a class="btn btn-sm btn-outline-secondary" href="{% url 'dm_thread' question.author.id %}">Message author</a>
        {% endif %}
      </div>

      <div class="mb-2">{{ question.content|linebreaks }}</div>
      <div>{% for t in question.topics.all %}<span class="badge bg-secondary">{{ t.name }}</span>{% endfor %}</div>
    </div>
  </div>

  {% if user.is_authenticated %}
    <div class="card mb-3">
      <div class="card-body">
        <h6 class="mb-2">Your Answer</h6>
        <form method="post" action="{% url 'forum_answer' question.id %}">
          {% csrf_token %}
          {{ a_form.content }}
          <button class="btn btn-primary btn-sm mt-2">Submit Answer</button>
        </form>
      </div>
    </div>
  {% endif %}

  <h6 class="mb-3">Answers</h6>
  {% for ans in question.top_answers %}
    {% include "forum/partials/answer.html" with answer=ans question=question level=0 %}
  {% empty %}
    <div class="text-muted">No answers yet.</div>
  {% endfor %}
</div>
</body>
</html>
